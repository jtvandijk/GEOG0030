renv::status()
install.packages('yaml')
install.packages('rmarkdown')
renv::snapshot()
install.packages(sf,type='binary')
install.packages('sf',type='binary')
install.packages('sf',type='binary')
renv::snapshot()
install.packages('data.table',type='binary')
renv::snapshot()
install.packages('terra',type='binary')
renv::snapshot()
install.packages('raster',type='binary')
renv::snapshot()
renv::snapshot()
install.packages('formatR')
#| label: fig-police-data
#| echo: False
#| fig-cap: 'Downloading data on reported crimes through [data.police.uk](https://data.police.uk/)'
knitr::include_graphics('images/w02/police-data.png')
#| label: 02-load-libraries
#| classes: styled-output
#| echo: True
#| eval: True
#| output: False
#| tidy: True
#| filename: "R code"
# load libraries
library(tidyverse)
library(sf)
library(tmap)
library(osmdata)
#| label: 02-combine-csv
#| echo: True
#| eval: True
#| tidy: True
#| filename: 'R code'
# list all csv files
crime_df <- list.files(path="data/attributes/crime/", full.names=TRUE, recursive=TRUE) |>
# read individual csv files
lapply(read_csv) |>
# bind together into one
bind_rows()
crime_df
# list all csv files
crime_df <- list.files(path="data/attributes/London-Crime/", full.names=TRUE, recursive=TRUE) |>
# read individual csv files
lapply(read_csv) |>
# bind together into one
bind_rows()
crime_df
View(crime_df)
View(crime_df)
nroow(crime_df)
nrow(crime_df)
names(crime_df)
crime_df
crime_df <- crime_df |>
clean_names()
library(janitor)
clean_names()
#| label: 02-rename-fields
#| classes: styled-output
#| echo: True
#| eval: True
#| tidy: True
#| filename: "R code"
# clean names
crime_df <- crime_df |>
clean_names()
names(crime_df)
unique(crime_df$crime_type)
theft_bike
#| label: 02-filter-crime
#| classes: styled-output
#| echo: True
#| eval: True
#| tidy: True
#| filename: "R code"
# unique types
unique(crime_df$crime_type)
# filter
theft_bike <- crime_df |>
filter(crime_type == 'Bicycle theft')
theft_bike
#| label: 02-station-data
#| classes: styled-output
#| echo: True
#| eval: True
#| warning: False
#| cache: True
#| filename: 'R code'
# read spatial data
msoa21 <- st_read('data/spatial/London-MSOA-2021.gpkg')
# define our bbox coordinates, use WGS84
bbox_london <- msoa21 |>
st_transform(4326) |>
st_bbox()
msoa21
st_crs(msoa21)
t <- msoa21 |> st_transform(4326)
install.packages('stats19')
s
library(tidyverse)
library(stats19)
library(sf)
df <- get_stats19(year = 2023, type = 'collision')
df <- get_stats19(year = 2022, type = 'collision')
df
View(df)
sf <- format_sf(df)
install.packages('spatstat')
install.packages('dbscan')
#| label: 03-load-libraries
#| classes: styled-output
#| echo: True
#| eval: True
#| output: False
#| tidy: True
#| filename: 'R code'
# load libraries
library(tidyverse)
library(sf)
library(tmap)
library(spatstat)
library(dbscan)
#| label: 01-load-gpkg-csv
#| classes: styled-output
#| echo: True
#| eval: True
#| tidy: True
#| filename: 'R code'
# load msoa dataset
msoa21 <- st_read('data/spatial/London-MSOA-2021.gpkg')
# load bicycle theft dataset
theft_bike <- st_read('data/spatial/London-BicycleTheft-2023.gpkg')
# inspect
head(msoa21)
# inspect
head(theft_bike)
#| label: 03-intersect-point-in-poly
#| classes: styled-output
#| echo: True
#| eval: True
#| tidy: True
#| message: False
#| filename: "R code"
# point in polygon
msoa21$theft_bike_n <- lengths(st_intersects(msoa_london, theft_bike))
#| label: 03-intersect-point-in-poly
#| classes: styled-output
#| echo: True
#| eval: True
#| tidy: True
#| message: False
#| filename: "R code"
# point in polygon
msoa21$theft_bike_n <- lengths(st_intersects(msoa21, theft_bike))
msoa21
msoa21 <- msoa21 |>
mutate(km_sq = as.numeric(st_area(msoa21)) / 1e6)
msoa21 <-  msoa21 |>
mutate(theft_bike_n = lengths(st_intersects(msoa21, theft_bike)
msoa21 <-  msoa21 |>
msoa21 <- msoa21 |>
mutate(theft_bike_n = lengths(st_intersects(msoa21, theft_bike))
msoa21 <- msoa21 |>
msoa21 <- msoa21 |>
mutate(theft_bike_n = lengths(st_intersects(msoa21, theft_bike))
msoa21 <- msoa21 |>
msoa21 <- msoa21 |>
mutate(theft_bike_n = lengths(st_intersects(msoa21, theft_bike))
msoa21 <- msoa21 |>
msoa21 <- msoa21 |>
mutate(theft_bike_n = lengths(st_intersects(msoa21, theft_bike)))
msoa21
msoa21  <- msoa21 |>
mutate(thef_km_sq = theft_bike_n/km_sq)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'pretty',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Share of population',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'jenks',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Share of population',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'quantile',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Share of population',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'quantile',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Thefts / km$^2$',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'quantile',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Thefts / Square kilometre',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
#| label: fig-03-choro-3
#| fig-cap: Number of reported bicycle thefts by square kilometre.
#| echo: True
#| eval: True
#| cache: True
#| filename: "R code"
# shape, polygons
tm_shape(msoa21) +
# specify column, classes, labels, title
tm_polygons(
col= 'thef_km_sq', n = 5, style = 'jenks',
border.col = '#ffffff',
border.alpha = 0.3,
palette = c('#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'),
title = 'Thefts / Square kilometre',
) +
# set layout
tm_layout(
frame = FALSE,
legend.position = c('left', 'bottom'),
)
